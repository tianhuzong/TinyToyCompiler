# TinyToyCompiler 开发手册

## 序言
这个文档是TinyToyCompiler 开发手册，记录了自己的一些心得，也便于自己或他人对这个编译器进行修改，对于入门编译器的一些萌新给予一些启示。

## 语言简介

这个语言是采用Flex+Bison+LLVM9编写的一个C风格的小型语言。这个语言有如下特点：
- 只有int整数一种数据类型
- 语句后面不用带分号
- 源代码开放，易于扩展
- ...还有众多特点等着你去细细品味

## 编译的一般过程
一段代码的编译一般要经过`词法分析->语法分析->语义分析->中间代码生成->优化->生成目标代码`的过程。

### 词法分析
根据网络上百科的内容：词法分析是计算机科学中将字符序列转换为单词序列的过程。进行词法分析的程序或者函数叫作词法分析器
简单来说就是把你输入的代码分成一个一个的单词。

网络上有很多实现词法分析器的方法，例如自己编写正则表达式、编写一个状态机，或者是使用一些工具。在本项目中我们使用的是Flex工具来生成词法分析器。

例子：[正则表达式写一个词法分析器](https://docs.python.org/zh-cn/3.13/library/re.html#writing-a-tokenizer)

### 语法分析
根据网络上百科的内容：语法分析是编译过程的一个逻辑阶段。语法分析的任务是在词法分析的基础上将单词序列组合成各类语法短语，如“程序”，“语句”，“表达式”等等.语法分析程序判断源程序在结构上是否正确.源程序的结构由上下文无关文法描述.

语法分析器的输出是一棵抽象语法树（Abstract Syntax Tree，AST）。AST是一种树状结构，它将源程序的语法结构表示出来。AST的每个节点都代表着源程序中的一个语法短语。AST的根节点代表着整个程序。

在本项目中我们使用的是Bison工具来生成语法分析器。

### 语义分析
语义分析是编译过程的一个阶段。语义分析的任务是对源程序进行静态分析，以确定程序的语义正确性。
语义分析可能进行着类似于变量类型检查，作用域分析之类的操作。
由于本项目的语言只有一种数据类型，所以将语义分析这一部分去掉了。也就没有定义类型系统。

### 中间代码生成
中间代码生成是编译过程的一个阶段。中间代码生成的任务是将源程序的语法结构转换成中间代码（如LLVM IR）。
本项目使用LLVM IR作为中间代码。

### 优化
优化是编译过程的一个阶段。优化的任务是对中间代码进行优化，以提高代码的运行效率。
优化可能包括常量折叠、死代码消除、循环展开、寄存器分配、代码调度等等。

### 生成目标代码
生成目标代码是编译过程的一个阶段。生成目标代码的任务是将中间代码转换成目标代码（如汇编语言）。

由于在语法分析器中我们需要生成AST,所以我们先讲AST节点的相关内容。
下一个章节我们将从AST节点的设计开始。
传送门: [AST节点设计](AST.md)
